{"functions":[{"name":"parseDate","body":"(dateStr) => {\n  let dateArray = dateStr.split(\"-\")\n  {\n    year: dateArray[0].parseInt(),\n    month: dateArray[1].parseInt()\n  }\n  \n}\n","role":null},{"name":"intersection","body":"(setsArray) => {\n  setsArray.filter(set => set != null).map((set) => set!.toArray()).reduce((a, b) => a.filter((c) => b.includes(c)))\n}\n","role":null},{"name":"upsertPrivilege","body":"(roleName, privilege) => {\n  let role = Role.byName(roleName)\n  let updatedPrivileges = role!.privileges.append(privilege)\n  role!.update({\n    privileges: updatedPrivileges\n  }\n  )\n}\n","role":null},{"name":"getDbb004BankingSummary","body":"(permitNumber, year) => {\n  let modifiedBanking = administrativeReports.where(.permitNumber == permitNumber && .year == year).first()\n  let allowedAppropriation = {\n    if (modifiedBanking != null) {\n      {\n        value: modifiedBanking!.allowedAppropriation?.value\n      }\n      \n    } else {\n      null\n    }\n  }\n  let pumpingLimitThisYear = {\n    if (modifiedBanking != null && modifiedBanking!.pumpingLimitThisYear != null) {\n      {\n        value: modifiedBanking!.pumpingLimitThisYear?.value\n      }\n      \n    } else {\n      null\n    }\n  }\n  let flowMeterLimit = {\n    let lastMeterReadingPrevYear = meterReadings.where((meterReading) => {\n      let recordYear = parseDate(meterReading.date).year\n      meterReading.permitNumber == permitNumber && recordYear == (year.parseInt() - 1)\n    }).order(desc((doc) => parseDate(doc.date).month)).order(desc((doc) => parseDate(doc.date).year)).first()\n    let lastFlowMeterPrevYear = {\n      if (lastMeterReadingPrevYear != null) {\n        lastMeterReadingPrevYear!.flowMeter?.value\n      } else {\n        null\n      }\n    }\n    if (pumpingLimitThisYear != null && lastFlowMeterPrevYear != null) {\n      let pumpingLimit = pumpingLimitThisYear?.value\n      let flowMeter = lastFlowMeterPrevYear\n      let sum = Math.sum([pumpingLimit, flowMeter])\n      {\n        value: Math.round(sum, 2)\n      }\n      \n    } else {\n      null\n    }\n  }\n  {\n    permitNumber: permitNumber,\n    year: year,\n    bankingData: [{\n      name: \"allowedAppropriation\",\n      value: allowedAppropriation\n    }\n    , {\n      name: \"pumpingLimitThisYear\",\n      value: pumpingLimitThisYear\n    }\n    , {\n      name: \"flowMeterLimit\",\n      value: flowMeterLimit\n    }\n    ]\n  }\n  \n}\n","role":null},{"name":"upsertCollection","body":"(collection) => {\n  let coll = Collection.byName(collection!.name)\n  if (coll.exists()) {\n    coll!.update(collection)\n  } else {\n    Collection.create(collection)\n  }\n}\n","role":null},{"name":"upsertFunction","body":"(function) => {\n  let fn = Function.byName(function!.name)\n  if (fn.exists()) {\n    fn!.update(function)\n  } else {\n    Function.create(function)\n  }\n}\n","role":null},{"name":"upsertRole","body":"(role) => {\n  let r = Role.byName(role!.name)\n  if (r.exists()) {\n    r!.update(role)\n  } else {\n    Role.create(role)\n  }\n}\n","role":null},{"name":"upsertCollections","body":"(collections) => {\n  collections!.map((collection) => upsertCollection(collection))\n}\n","role":null},{"name":"upsertFunctions","body":"(fns) => {\n  fns.map((fn) => upsertFunction(fn))\n}\n","role":null},{"name":"upsertRoles","body":"(roles) => {\n    roles.map(role => upsertRole(role))\n  }\n","role":null}],"collections":[{"name":"meterReadings","history_days":null,"indexes":{},"constraints":[],"data":null},{"name":"administrativeReports","history_days":null,"indexes":{},"constraints":[],"data":null},{"name":"wellPermits","history_days":null,"indexes":{},"constraints":[],"data":null},{"name":"users","history_days":null,"indexes":{},"constraints":[],"data":null},{"name":"wellPermitRecords","history_days":null,"indexes":{},"constraints":[],"data":null},{"name":"agentInfo","history_days":null,"indexes":{},"constraints":[],"data":null},{"name":"wellUsage","history_days":null,"indexes":{},"constraints":[],"data":null},{"name":"modifiedBankingSummary","history_days":null,"indexes":{},"constraints":[],"data":null}],"roles":[{"name":"readWriteAll","membership":[],"privileges":[{"resource":"meterReadings","actions":{"read":true,"write":true,"create":true,"delete":true}},{"resource":"administrativeReports","actions":{"read":true,"write":true,"create":true,"delete":true}},{"resource":"wellPermits","actions":{"read":true,"write":true,"create":true,"delete":true}},{"resource":"users","actions":{"read":true,"write":true,"create":true,"delete":true}},{"resource":"wellPermitRecords","actions":{"read":true,"write":true,"create":true,"delete":true}},{"resource":"agentInfo","actions":{"read":true,"write":true,"create":true,"delete":true}},{"resource":"wellUsage","actions":{"read":true,"write":true,"create":true,"delete":true}},{"resource":"modifiedBankingSummary","actions":{"read":true,"write":true,"create":true,"delete":true}},{"resource":"parseDate","actions":{"call":true}},{"resource":"intersection","actions":{"call":true}},{"resource":"upsertPrivilege","actions":{"call":true}},{"resource":"getDbb004BankingSummary","actions":{"call":true}}],"data":null}]}